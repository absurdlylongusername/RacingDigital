<mat-card class="leaderboard-card">
  <div class="selector-row">
    <mat-form-field appearance="outline" class="horse-select">
      <mat-label>Select a horse</mat-label>
      <mat-select [value]="selectedHorse()" (valueChange)="onHorseChange($event)">

        <!-- Optional: custom trigger so the selected value also shows name | count -->
        <mat-select-trigger>
          <ng-container *ngIf="selectedHorse(); else placeholder">
            <div class="opt trigger">
              <span class="name">{{ selectedHorse() }}</span>
              <span class="count">{{ horseRaceCounts()[selectedHorse()!] }}</span>
            </div>
          </ng-container>
          <ng-template #placeholder>— Select horse —</ng-template>
        </mat-select-trigger>

        <mat-option [value]="null">— Select horse —</mat-option>

        <mat-option *ngFor="let h of horses()" [value]="h">
          <div class="opt">
            <span class="name">{{ h }}</span>
            <span class="count">{{ horseRaceCounts()[h] }}</span>
          </div>
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <mat-divider></mat-divider>

  <div class="table-container" *ngIf="data().length > 0; else empty">
    <table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z1 leaderboard-table">
      <ng-container matColumnDef="race">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Race</th>
        <td mat-cell *matCellDef="let r">{{ r.raceName }}</td>
      </ng-container>

      <ng-container matColumnDef="jockey">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Jockey</th>
        <td mat-cell *matCellDef="let r">{{ r.jockey }}</td>
      </ng-container>

      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Finishing position</th>
        <td mat-cell *matCellDef="let r">{{ r.position }}</td>
      </ng-container>

      <ng-container matColumnDef="distanceBeaten">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Distance beaten</th>
        <td mat-cell *matCellDef="let r">{{ r.distanceBeaten }}</td>
      </ng-container>

      <ng-container matColumnDef="timeBeaten">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Time beaten</th>
        <td mat-cell *matCellDef="let r">{{ r.timeBeaten }}</td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="cols; sticky: true"></tr>
      <tr mat-row *matRowDef="let row; columns: cols;"></tr>
    </table>
  </div>

  <ng-template #empty>
    <p class="empty" *ngIf="selectedHorse(); else prompt">No races for {{ selectedHorse() }}.</p>
    <ng-template #prompt><p class="empty">Pick a horse to see its races &amp; jockeys.</p></ng-template>
  </ng-template>
</mat-card>
